"use client";

/**
 * =============================================================================
 * STANDALONE SIDEBAR DEMO FOR R&D - PROFESSIONAL MODE
 * =============================================================================
 * 
 * This is a complete, self-contained copy of the dashboard sidebar with full
 * collapsible state functionality and PROFESSIONAL ANIMATIONS.
 * 
 * Key Features:
 * - Collapsible sidebar (48px rail when collapsed, 256px when expanded)
 * - 40px hit targets for accessibility
 * - Dropdown menus for nav items with children in collapsed state
 * - Store switcher accessible in both states
 * - User menu with account options
 * - AI services panel
 * - Keyboard shortcut: âŒ˜B to toggle
 * 
 * PROFESSIONAL ANIMATION PATTERNS (Vercel/Geist Style):
 * - Simple CSS transitions (150ms duration)
 * - Hover background color changes
 * - Subtle scale effects on tap (active:scale-[0.98])
 * - Chevron rotation with CSS transition
 * - No bouncing, no magnetic effects, no 3D tilts
 * - Respects prefers-reduced-motion via CSS
 * 
 * CSS Variables Used:
 * - --sidebar-width: 16rem (256px)
 * - --sidebar-width-icon: 3rem (48px)
 */

import * as React from "react";
import { useState, useCallback, useMemo } from "react";
import Link from "next/link";
import { usePathname } from "next/navigation";
import { motion, AnimatePresence } from "framer-motion";
import {
  LayoutDashboard,
  ShoppingCart,
  Users,
  TrendingUp,
  Settings,
  Layers,
  Tag,
  Image,
  Paintbrush,
  Filter,
  MessageSquare,
  ChevronRight,
  ChevronDown,
  ExternalLink,
  Sparkles,
  Brain,
  Zap,
  Moon,
  Sun,
  LogOut,
  Plus,
  Bell,
  HelpCircle,
  Rocket,
  CheckCircle,
  Cloud,
  Bot,
  FileSearch,
  BarChart3,
  Cpu,
  PanelLeft,
  RefreshCw,
  Star,
  Heart,
} from "lucide-react";
import {
  Sidebar,
  SidebarProvider,
  SidebarInset,
  SidebarHeader,
  SidebarContent,
  SidebarFooter,
  SidebarMenu,
  SidebarMenuItem,
  SidebarMenuButton,
  SidebarMenuBadge,
  SidebarGroup,
  SidebarGroupLabel,
  SidebarGroupContent,
  SidebarMenuSub,
  SidebarMenuSubItem,
  SidebarMenuSubButton,
  useSidebar,
} from "@/components/ui/sidebar";
import { Button } from "@/components/ui/button";
import { Badge } from "@/components/ui/badge";
import { Avatar, AvatarFallback, AvatarImage } from "@/components/ui/avatar";
import {
  Tooltip,
  TooltipContent,
  TooltipTrigger,
  TooltipProvider,
} from "@/components/ui/tooltip";
import {
  DropdownMenu,
  DropdownMenuContent,
  DropdownMenuItem,
  DropdownMenuSeparator,
  DropdownMenuTrigger,
  DropdownMenuLabel,
  DropdownMenuGroup,
} from "@/components/ui/dropdown-menu";
import {
  Collapsible,
  CollapsibleContent,
  CollapsibleTrigger,
} from "@/components/ui/collapsible";
import {
  // Animated Icons (kept for demo content section)
  AnimatedCheck,
  AnimatedX,
  AnimatedArrow,
  AnimatedPlusMinus,
  AnimatedHamburger,
  AnimatedChevron,
  AnimatedHeart,
  AnimatedStar,
  AnimatedBell,
  AnimatedCopy,
  AnimatedSpinner,
  AnimatedSuccess,
  AnimatedError,
  AnimatedBookmark,
  AnimatedTrash,
  // Animated Components (kept for demo content section)
  AnimatedButton,
  AnimatedIconButton,
  AnimatedCard,
  AnimatedBadge,
  NotificationDot,
  AnimatedCheckbox,
  AnimatedToggle,
  AnimatedInput,
  // Animation Wrappers (kept for demo content section)
  HoverScale,
  TapBounce,
  StaggerList,
  StaggerItem,
  Magnetic,
  TiltCard,
} from "@/components/ui/animated";
import { cn } from "@/shared/utils";

// =============================================================================
// DEMO CARD HELPER COMPONENT
// =============================================================================

function DemoCard({ label, children }: { label: string; children: React.ReactNode }) {
  return (
    <div className="flex flex-col items-center gap-2">
      <div className="flex h-12 items-center justify-center">{children}</div>
      <span className="text-xs font-medium text-[var(--ds-gray-600)]">{label}</span>
    </div>
  );
}

// =============================================================================
// TYPES
// =============================================================================

type PlanType = "free" | "trial" | "pro";
type UserRole = "owner" | "admin" | "staff";

interface NavItem {
  id: string;
  title: string;
  href: string;
  icon: React.ComponentType<{ className?: string }>;
  badge?: number | string;
  badgeVariant?: "default" | "warning" | "success" | "destructive";
  external?: boolean;
  children?: NavSubItem[];
}

interface NavSubItem {
  id: string;
  title: string;
  href: string;
  badge?: string;
  external?: boolean;
}

interface NavSection {
  id: string;
  label?: string;
  items: NavItem[];
}

interface IndigoService {
  id: string;
  name: string;
  shortName: string;
  icon: React.ComponentType<{ className?: string }>;
  status: "active" | "setup" | "disabled";
  description: string;
  href: string;
}


// =============================================================================
// NAVIGATION CONFIGURATION
// =============================================================================

function createNavigation(counts: { pendingOrders: number; lowStock: number }): NavSection[] {
  return [
    {
      id: "overview",
      items: [
        {
          id: "dashboard",
          title: "Dashboard",
          href: "/dashboard",
          icon: LayoutDashboard,
        },
        {
          id: "orders",
          title: "Orders",
          href: "/dashboard/orders",
          icon: ShoppingCart,
          badge: counts.pendingOrders > 0 ? counts.pendingOrders : undefined,
          badgeVariant: "warning",
          children: [
            { id: "all-orders", title: "All Orders", href: "/dashboard/orders" },
            { id: "returns", title: "Returns", href: "/dashboard/orders/returns" },
          ],
        },
      ],
    },
    {
      id: "catalog",
      label: "Catalog",
      items: [
        {
          id: "products",
          title: "Products",
          href: "/dashboard/products",
          icon: Tag,
          children: [
            { id: "all-products", title: "All Products", href: "/dashboard/products" },
            { id: "collections", title: "Collections", href: "/dashboard/collections" },
            { id: "categories", title: "Categories", href: "/dashboard/categories" },
          ],
        },
        {
          id: "inventory",
          title: "Inventory",
          href: "/dashboard/inventory",
          icon: Layers,
          badge: counts.lowStock > 0 ? `${counts.lowStock} low` : undefined,
          badgeVariant: "warning",
          children: [
            { id: "all-inventory", title: "Stock Levels", href: "/dashboard/inventory" },
            { id: "inventory-history", title: "History", href: "/dashboard/inventory/history" },
          ],
        },
        {
          id: "attributes",
          title: "Attributes",
          href: "/dashboard/attributes",
          icon: Filter,
        },
      ],
    },
    {
      id: "content",
      label: "Content",
      items: [
        {
          id: "storefront",
          title: "Storefront Editor",
          href: "/storefront",
          icon: Paintbrush,
          external: true,
        },
        {
          id: "media",
          title: "Media Library",
          href: "/dashboard/media",
          icon: Image,
        },
      ],
    },
    {
      id: "customers",
      label: "Customers",
      items: [
        {
          id: "customers",
          title: "Customers",
          href: "/dashboard/customers",
          icon: Users,
          children: [
            { id: "all-customers", title: "All Customers", href: "/dashboard/customers" },
            { id: "groups", title: "Groups", href: "/dashboard/customers/groups" },
          ],
        },
        {
          id: "reviews",
          title: "Reviews",
          href: "/dashboard/reviews",
          icon: MessageSquare,
        },
      ],
    },
    {
      id: "marketing",
      label: "Marketing",
      items: [
        {
          id: "marketing",
          title: "Marketing",
          href: "/dashboard/marketing",
          icon: Zap,
          children: [
            { id: "discounts", title: "Discounts", href: "/dashboard/marketing/discounts" },
            { id: "campaigns", title: "Campaigns", href: "/dashboard/marketing/campaigns" },
            { id: "automations", title: "Automations", href: "/dashboard/marketing/automations" },
          ],
        },
      ],
    },
    {
      id: "insights",
      label: "Insights",
      items: [
        {
          id: "analytics",
          title: "Analytics",
          href: "/dashboard/analytics",
          icon: TrendingUp,
        },
      ],
    },
  ];
}


// Indigo AI Services Configuration
const INDIGO_SERVICES: IndigoService[] = [
  {
    id: "indigo-ai",
    name: "Indigo AI",
    shortName: "AI Content",
    icon: Sparkles,
    status: "active",
    description: "AI-powered content generation",
    href: "/dashboard/settings/ai-services/content",
  },
  {
    id: "indigo-search",
    name: "Indigo Search",
    shortName: "Smart Search",
    icon: FileSearch,
    status: "active",
    description: "Intelligent product search",
    href: "/dashboard/settings/ai-services/search",
  },
  {
    id: "indigo-recommendations",
    name: "Indigo Recommendations",
    shortName: "Recommend",
    icon: Brain,
    status: "active",
    description: "Personalized product recommendations",
    href: "/dashboard/settings/ai-services/recommendations",
  },
  {
    id: "indigo-insights",
    name: "Indigo Insights",
    shortName: "Insights",
    icon: BarChart3,
    status: "setup",
    description: "AI analytics & forecasting",
    href: "/dashboard/settings/ai-services/insights",
  },
  {
    id: "indigo-content",
    name: "Indigo Content",
    shortName: "Translate",
    icon: Bot,
    status: "active",
    description: "Translation & localization",
    href: "/dashboard/settings/ai-services/translate",
  },
  {
    id: "indigo-media",
    name: "Indigo Media",
    shortName: "Media AI",
    icon: Cpu,
    status: "disabled",
    description: "Image analysis & auto-tagging",
    href: "/dashboard/settings/ai-services/media",
  },
];


// =============================================================================
// HELPER COMPONENTS
// =============================================================================

function StatusDot({ status }: { status: IndigoService["status"] }) {
  return (
    <span
      className={cn(
        "h-2 w-2 rounded-full",
        status === "active" && "bg-[var(--ds-green-600)]",
        status === "setup" && "bg-[var(--ds-amber-500)]",
        status === "disabled" && "bg-[var(--ds-gray-400)]"
      )}
    />
  );
}

// =============================================================================
// STORE SWITCHER COMPONENT (Professional - Simple CSS Transitions)
// =============================================================================

interface StoreSwitcherProps {
  tenantName: string;
  storeLogo?: string | null;
  planType: PlanType;
  trialDaysLeft: number;
  storeSlug?: string;
  isCollapsed: boolean;
}

function StoreSwitcher({
  tenantName,
  storeLogo,
  planType,
  trialDaysLeft,
  storeSlug,
  isCollapsed,
}: StoreSwitcherProps) {
  const planBadge = {
    free: { label: "Free", className: "bg-[var(--ds-gray-200)] text-[var(--ds-gray-700)]" },
    trial: { label: `${trialDaysLeft}d left`, className: "bg-[var(--ds-blue-100)] text-[var(--ds-blue-700)]" },
    pro: { label: "Pro", className: "bg-[var(--ds-green-100)] text-[var(--ds-green-700)]" },
  }[planType];

  // Unified dropdown content for both states
  const dropdownContent = (
    <DropdownMenuContent 
      side={isCollapsed ? "right" : "bottom"} 
      align="start" 
      sideOffset={isCollapsed ? 8 : 4} 
      className="w-64 overscroll-contain"
    >
      <DropdownMenuLabel className="flex flex-col gap-1">
        <span className="font-medium">{tenantName}</span>
        <span className="text-xs text-[var(--ds-gray-600)]">
          {storeSlug ? `${storeSlug}.indigo.store` : "Configure domain"}
        </span>
        <Badge variant="secondary" className={cn("w-fit text-[10px] px-1.5 py-0 h-4 mt-1", planBadge.className)}>
          {planBadge.label}
        </Badge>
      </DropdownMenuLabel>
      <DropdownMenuSeparator />
      <DropdownMenuItem asChild>
        <Link href="/dashboard/settings" className="flex items-center gap-2 cursor-pointer">
          <Settings className="h-4 w-4" />
          Store Settings
        </Link>
      </DropdownMenuItem>
      {storeSlug && (
        <DropdownMenuItem asChild>
          <Link href={`/store/${storeSlug}`} target="_blank" className="flex items-center gap-2 cursor-pointer">
            <ExternalLink className="h-4 w-4" />
            View Storefront
          </Link>
        </DropdownMenuItem>
      )}
      <DropdownMenuSeparator />
      <DropdownMenuItem asChild>
        <Link href="/dashboard/settings/domains" className="flex items-center gap-2 cursor-pointer">
          <Cloud className="h-4 w-4" />
          Custom Domain
        </Link>
      </DropdownMenuItem>
      <DropdownMenuSeparator />
      <DropdownMenuItem className="flex items-center gap-2 text-[var(--ds-gray-600)]" disabled>
        <Plus className="h-4 w-4" />
        Create New Store
        <Badge variant="secondary" className="ml-auto text-[10px]">Soon</Badge>
      </DropdownMenuItem>
    </DropdownMenuContent>
  );

  // Store icon - simple, no magnetic effect
  const storeIcon = (
    <div 
      className="flex h-10 w-10 shrink-0 items-center justify-center rounded-lg bg-[var(--ds-gray-1000)] text-white font-semibold text-sm overflow-hidden transition-transform duration-150 active:scale-[0.98]"
    >
      {storeLogo ? (
        <img src={storeLogo} alt={tenantName} className="h-full w-full object-cover" />
      ) : (
        tenantName.charAt(0).toUpperCase()
      )}
    </div>
  );

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <button 
          className={cn(
            "flex items-center rounded-lg text-left group focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ds-blue-600)] focus-visible:ring-offset-1",
            "transition-all duration-150",
            isCollapsed 
              ? "h-10 w-10 justify-center p-0" 
              : "w-full gap-3 p-2 hover:bg-[var(--ds-gray-100)] active:scale-[0.99]"
          )}
          aria-label={`${tenantName} store menu`}
        >
          {storeIcon}
          
          {/* Text content - hidden when collapsed */}
          {!isCollapsed && (
            <div className="flex-1 min-w-0 overflow-hidden">
              <div className="flex items-center gap-2">
                <span className="font-medium text-sm text-[var(--ds-gray-900)] truncate">
                  {tenantName}
                </span>
                <Badge variant="secondary" className={cn("text-[10px] px-1.5 py-0 h-4 shrink-0", planBadge.className)}>
                  {planBadge.label}
                </Badge>
              </div>
              <span className="text-xs text-[var(--ds-gray-600)] truncate block">
                {storeSlug ? `${storeSlug}.indigo.store` : "Configure domain"}
              </span>
            </div>
          )}
          
          {/* Chevron - hidden when collapsed */}
          {!isCollapsed && (
            <ChevronDown 
              className="h-4 w-4 shrink-0 text-[var(--ds-gray-500)] group-hover:text-[var(--ds-gray-700)] transition-colors duration-150" 
            />
          )}
        </button>
      </DropdownMenuTrigger>
      {dropdownContent}
    </DropdownMenu>
  );
}


// =============================================================================
// NAVIGATION ITEM COMPONENT (Professional - Simple CSS Transitions)
// =============================================================================

interface NavItemProps {
  item: NavItem;
  isActive: boolean;
  isCollapsed: boolean;
  isOpen: boolean;
  onToggle: () => void;
  pathname: string;
}

function NavItemComponent({ item, isActive, isCollapsed, isOpen, onToggle, pathname }: NavItemProps) {
  const hasChildren = item.children && item.children.length > 0;
  const Icon = item.icon;

  const isChildActive = hasChildren && item.children?.some(
    (child) => pathname === child.href || pathname.startsWith(child.href + "/")
  );

  const isItemActive = isActive || isChildActive;

  // Badge component - simple, no pulse animation
  const badgeElement = item.badge ? (
    <span
      className={cn(
        "inline-flex items-center justify-center text-[10px] font-medium px-1.5 py-0 h-5 min-w-5 rounded-sm tabular-nums",
        item.badgeVariant === "warning" 
          ? "bg-[var(--ds-amber-500)] text-white" 
          : "bg-[var(--ds-gray-200)] text-[var(--ds-gray-700)]"
      )}
    >
      {item.badge}
    </span>
  ) : null;

  // Collapsed state with children - show dropdown menu
  if (isCollapsed && hasChildren) {
    return (
      <SidebarMenuItem>
        <DropdownMenu>
          <DropdownMenuTrigger asChild>
            <button
              className={cn(
                "flex h-10 w-10 items-center justify-center rounded-md transition-colors duration-150",
                "hover:bg-[var(--ds-gray-100)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ds-blue-600)]",
                "active:scale-[0.98]",
                isItemActive && "bg-[var(--ds-gray-100)] text-[var(--ds-gray-900)]"
              )}
              aria-label={item.title}
            >
              <Icon className="h-4 w-4" />
            </button>
          </DropdownMenuTrigger>
          <DropdownMenuContent side="right" align="start" sideOffset={8} className="w-48 overscroll-contain">
            <DropdownMenuLabel className="flex items-center gap-2 text-xs font-medium text-[var(--ds-gray-600)]">
              <Icon className="h-3.5 w-3.5" />
              {item.title}
              {badgeElement && <span className="ml-auto">{badgeElement}</span>}
            </DropdownMenuLabel>
            <DropdownMenuSeparator />
            {item.children?.map((child) => (
              <DropdownMenuItem key={child.id} asChild>
                <Link
                  href={child.href}
                  target={child.external ? "_blank" : undefined}
                  className={cn(
                    "flex items-center gap-2 text-sm cursor-pointer",
                    (pathname === child.href || pathname.startsWith(child.href + "/")) &&
                      "bg-[var(--ds-gray-100)] font-medium"
                  )}
                >
                  <span>{child.title}</span>
                  {child.badge && (
                    <Badge variant="secondary" className="ml-auto text-xs">
                      {child.badge}
                    </Badge>
                  )}
                  {child.external && <ExternalLink className="h-3 w-3 ml-auto text-[var(--ds-gray-500)]" />}
                </Link>
              </DropdownMenuItem>
            ))}
          </DropdownMenuContent>
        </DropdownMenu>
      </SidebarMenuItem>
    );
  }

  // Collapsed state without children - show icon with tooltip
  if (isCollapsed) {
    return (
      <SidebarMenuItem>
        <Tooltip>
          <TooltipTrigger asChild>
            <Link
              href={item.href}
              target={item.external ? "_blank" : undefined}
              className={cn(
                "flex h-10 w-10 items-center justify-center rounded-md transition-colors duration-150",
                "hover:bg-[var(--ds-gray-100)] focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ds-blue-600)]",
                "active:scale-[0.98]",
                isItemActive && "bg-[var(--ds-gray-100)] text-[var(--ds-gray-900)] font-medium"
              )}
              aria-label={item.title}
            >
              <Icon className="h-4 w-4" />
            </Link>
          </TooltipTrigger>
          <TooltipContent side="right" className="flex items-center gap-2">
            {item.title}
            {badgeElement}
          </TooltipContent>
        </Tooltip>
      </SidebarMenuItem>
    );
  }

  // Items without children - simple link with CSS hover
  if (!hasChildren) {
    return (
      <SidebarMenuItem>
        <SidebarMenuButton
          asChild
          isActive={isItemActive}
          className={cn(
            "transition-colors duration-150",
            isItemActive && "bg-[var(--ds-gray-100)] text-[var(--ds-gray-900)] font-medium"
          )}
        >
          <Link
            href={item.href}
            target={item.external ? "_blank" : undefined}
            className="flex items-center gap-2"
          >
            <Icon className="h-4 w-4 shrink-0" />
            <span className="flex-1 truncate">{item.title}</span>
            {badgeElement}
            {item.external && <ExternalLink className="h-3 w-3 shrink-0 text-[var(--ds-gray-500)]" />}
          </Link>
        </SidebarMenuButton>
      </SidebarMenuItem>
    );
  }

  // Items with children - collapsible with simple CSS chevron rotation
  return (
    <Collapsible open={isOpen} onOpenChange={onToggle}>
      <SidebarMenuItem>
        <CollapsibleTrigger asChild>
          <SidebarMenuButton
            isActive={isItemActive}
            className={cn(
              "transition-colors duration-150",
              isItemActive && "bg-[var(--ds-gray-100)] text-[var(--ds-gray-900)] font-medium"
            )}
          >
            <Icon className="h-4 w-4 shrink-0" />
            <span className="flex-1 truncate text-left">{item.title}</span>
            {badgeElement}
            <ChevronRight 
              className={cn(
                "h-4 w-4 shrink-0 text-[var(--ds-gray-500)] transition-transform duration-200",
                isOpen && "rotate-90"
              )} 
            />
          </SidebarMenuButton>
        </CollapsibleTrigger>
        <CollapsibleContent>
          <SidebarMenuSub>
            {item.children?.map((child) => (
              <SidebarMenuSubItem key={child.id}>
                <SidebarMenuSubButton
                  asChild
                  isActive={pathname === child.href || pathname.startsWith(child.href + "/")}
                >
                  <Link href={child.href} target={child.external ? "_blank" : undefined}>
                    <span>{child.title}</span>
                    {child.badge && (
                      <Badge variant="secondary" className="ml-auto text-xs">
                        {child.badge}
                      </Badge>
                    )}
                  </Link>
                </SidebarMenuSubButton>
              </SidebarMenuSubItem>
            ))}
          </SidebarMenuSub>
        </CollapsibleContent>
      </SidebarMenuItem>
    </Collapsible>
  );
}


// =============================================================================
// INDIGO AI SERVICES PANEL (Professional - Simple CSS Transitions)
// =============================================================================

interface IndigoServicesPanelProps {
  isCollapsed: boolean;
}

function IndigoServicesPanel({ isCollapsed }: IndigoServicesPanelProps) {
  const activeCount = INDIGO_SERVICES.filter((s) => s.status === "active").length;

  if (isCollapsed) {
    return (
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <button
            className="flex h-10 w-10 items-center justify-center rounded-lg bg-gradient-to-br from-[var(--ds-blue-100)] to-[var(--ds-purple-100)] hover:from-[var(--ds-blue-200)] hover:to-[var(--ds-purple-200)] transition-colors duration-150 focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ds-blue-600)] focus-visible:ring-offset-1 active:scale-[0.98]"
            aria-label="Indigo AI Services"
          >
            <Sparkles className="h-5 w-5 text-[var(--ds-blue-700)]" />
          </button>
        </DropdownMenuTrigger>
        <DropdownMenuContent side="right" align="start" sideOffset={8} className="w-56 overscroll-contain">
          <DropdownMenuLabel className="flex items-center justify-between">
            <div className="flex items-center gap-2">
              <Sparkles className="h-4 w-4 text-[var(--ds-blue-600)]" />
              <span>Indigo AI</span>
            </div>
            <span className="text-xs text-[var(--ds-gray-600)]">
              {activeCount}/{INDIGO_SERVICES.length} active
            </span>
          </DropdownMenuLabel>
          <DropdownMenuSeparator />
          {INDIGO_SERVICES.map((service) => (
            <DropdownMenuItem key={service.id} asChild>
              <Link href={service.href} className="flex items-center gap-2 cursor-pointer">
                <service.icon className="h-4 w-4" />
                <span className="flex-1">{service.shortName}</span>
                <StatusDot status={service.status} />
              </Link>
            </DropdownMenuItem>
          ))}
          <DropdownMenuSeparator />
          <DropdownMenuItem asChild>
            <Link href="/dashboard/settings/ai-services" className="flex items-center gap-2 cursor-pointer text-[var(--ds-gray-600)]">
              View all services
              <ChevronRight className="h-3 w-3 ml-auto" />
            </Link>
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    );
  }

  return (
    <div className="space-y-2">
      <div className="flex items-center justify-between px-2">
        <div className="flex items-center gap-2">
          <Sparkles className="h-4 w-4 text-[var(--ds-blue-600)]" />
          <span className="text-xs font-medium text-[var(--ds-gray-600)] uppercase tracking-wider">
            Indigo AI
          </span>
        </div>
        <div className="flex items-center gap-1">
          <span className="text-[10px] text-[var(--ds-green-600)] font-medium">
            {activeCount}
          </span>
          <span className="text-[10px] text-[var(--ds-gray-500)]">/</span>
          <span className="text-[10px] text-[var(--ds-gray-600)]">{INDIGO_SERVICES.length}</span>
        </div>
      </div>

      <div className="grid grid-cols-2 gap-1.5">
        {INDIGO_SERVICES.slice(0, 4).map((service) => (
          <Tooltip key={service.id}>
            <TooltipTrigger asChild>
              <Link
                href={service.href}
                className={cn(
                  "flex items-center gap-2 p-2 rounded-md text-xs cursor-pointer transition-colors duration-150",
                  service.status === "active" && "bg-[var(--ds-gray-100)] text-[var(--ds-gray-800)] hover:bg-[var(--ds-gray-200)]",
                  service.status === "setup" && "bg-[var(--ds-amber-50)] text-[var(--ds-amber-800)] hover:bg-[var(--ds-amber-100)] border border-[var(--ds-amber-200)]",
                  service.status === "disabled" && "bg-[var(--ds-gray-50)] text-[var(--ds-gray-600)] hover:bg-[var(--ds-gray-100)]"
                )}
              >
                <service.icon className="h-3.5 w-3.5 shrink-0" />
                <span className="truncate flex-1">{service.shortName}</span>
                <StatusDot status={service.status} />
              </Link>
            </TooltipTrigger>
            <TooltipContent side="right" className="max-w-48">
              <div className="space-y-1">
                <p className="font-medium">{service.name}</p>
                <p className="text-xs text-[var(--ds-gray-600)]">{service.description}</p>
              </div>
            </TooltipContent>
          </Tooltip>
        ))}
      </div>

      <Link
        href="/dashboard/settings/ai-services"
        className="flex items-center justify-center gap-1 py-1.5 text-xs text-[var(--ds-gray-600)] hover:text-[var(--ds-gray-800)] transition-colors duration-150 group"
      >
        <span>View all services</span>
        <ChevronRight className="h-3 w-3 group-hover:translate-x-0.5 transition-transform duration-150" />
      </Link>
    </div>
  );
}


// =============================================================================
// USER MENU COMPONENT (Professional - Simple CSS Transitions)
// =============================================================================

interface UserMenuProps {
  userEmail: string;
  userAvatarUrl?: string | null;
  userFullName?: string | null;
  userRole: UserRole;
  isCollapsed: boolean;
}

function UserMenuComponent({
  userEmail,
  userAvatarUrl,
  userFullName,
  userRole,
  isCollapsed,
}: UserMenuProps) {
  const [theme, setTheme] = useState<"light" | "dark">("light");
  const displayName = userFullName || userEmail.split("@")[0] || "User";
  const userInitial = (userFullName?.charAt(0) || userEmail.charAt(0) || "U").toUpperCase();

  const roleLabels: Record<UserRole, string> = {
    owner: "Owner",
    admin: "Admin",
    staff: "Staff",
  };

  const avatarColors = [
    "bg-[var(--ds-blue-600)]",
    "bg-[var(--ds-green-600)]",
    "bg-[var(--ds-purple-600)]",
    "bg-[var(--ds-amber-600)]",
    "bg-[var(--ds-pink-600)]",
  ];
  const colorIndex = userEmail.charCodeAt(0) % avatarColors.length;

  if (isCollapsed) {
    return (
      <DropdownMenu>
        <DropdownMenuTrigger asChild>
          <button
            className="flex h-10 w-10 items-center justify-center rounded-full focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ds-blue-600)] focus-visible:ring-offset-1 transition-transform duration-150 active:scale-[0.98]"
            aria-label={`${displayName} account menu`}
          >
            <Avatar className="h-9 w-9">
              <AvatarImage src={userAvatarUrl || undefined} alt={displayName} />
              <AvatarFallback className={cn("text-white text-sm font-medium", avatarColors[colorIndex])}>
                {userInitial}
              </AvatarFallback>
            </Avatar>
          </button>
        </DropdownMenuTrigger>
        <DropdownMenuContent side="right" align="end" sideOffset={8} className="w-56 overscroll-contain">
          <DropdownMenuLabel>
            <div className="flex flex-col">
              <span className="font-medium">{displayName}</span>
              <span className="text-xs text-[var(--ds-gray-600)]">{userEmail}</span>
            </div>
          </DropdownMenuLabel>
          <DropdownMenuSeparator />
          <DropdownMenuGroup>
            <DropdownMenuItem asChild>
              <Link href="/dashboard/settings/account">
                <Settings className="mr-2 h-4 w-4" />
                Account Settings
              </Link>
            </DropdownMenuItem>
            <DropdownMenuItem asChild>
              <Link href="/dashboard/settings/notifications">
                <Bell className="mr-2 h-4 w-4" />
                Notifications
              </Link>
            </DropdownMenuItem>
          </DropdownMenuGroup>
          <DropdownMenuSeparator />
          <DropdownMenuItem onClick={() => setTheme(theme === "dark" ? "light" : "dark")}>
            {theme === "dark" ? <Sun className="mr-2 h-4 w-4" /> : <Moon className="mr-2 h-4 w-4" />}
            {theme === "dark" ? "Light Mode" : "Dark Mode"}
          </DropdownMenuItem>
          <DropdownMenuSeparator />
          <DropdownMenuItem className="text-[var(--ds-red-600)]">
            <LogOut className="mr-2 h-4 w-4" />
            Sign Out
          </DropdownMenuItem>
        </DropdownMenuContent>
      </DropdownMenu>
    );
  }

  return (
    <DropdownMenu>
      <DropdownMenuTrigger asChild>
        <button 
          className="flex w-full items-center gap-3 rounded-lg p-2 hover:bg-[var(--ds-gray-100)] transition-colors duration-150 text-left group focus-visible:outline-none focus-visible:ring-2 focus-visible:ring-[var(--ds-blue-600)] focus-visible:ring-offset-1 active:scale-[0.99]"
        >
          <Avatar className="h-9 w-9">
            <AvatarImage src={userAvatarUrl || undefined} alt={displayName} />
            <AvatarFallback className={cn("text-white text-sm font-medium", avatarColors[colorIndex])}>
              {userInitial}
            </AvatarFallback>
          </Avatar>
          <div className="flex-1 min-w-0">
            <div className="flex items-center gap-2">
              <span className="font-medium text-sm text-[var(--ds-gray-900)] truncate">
                {displayName}
              </span>
              <Badge variant="secondary" className="text-[10px] px-1.5 py-0 h-4 bg-[var(--ds-gray-200)] text-[var(--ds-gray-600)]">
                {roleLabels[userRole]}
              </Badge>
            </div>
            <span className="text-xs text-[var(--ds-gray-600)] truncate block">
              {userEmail}
            </span>
          </div>
          <ChevronDown className="h-4 w-4 text-[var(--ds-gray-500)] group-hover:text-[var(--ds-gray-700)] transition-colors duration-150 shrink-0" />
        </button>
      </DropdownMenuTrigger>
      <DropdownMenuContent align="end" className="w-56">
        <DropdownMenuLabel>My Account</DropdownMenuLabel>
        <DropdownMenuSeparator />
        <DropdownMenuGroup>
          <DropdownMenuItem asChild>
            <Link href="/dashboard/settings/account">
              <Settings className="mr-2 h-4 w-4" />
              Account Settings
            </Link>
          </DropdownMenuItem>
          <DropdownMenuItem asChild>
            <Link href="/dashboard/settings/notifications">
              <Bell className="mr-2 h-4 w-4" />
              Notifications
            </Link>
          </DropdownMenuItem>
          <DropdownMenuItem asChild>
            <Link href="/help" target="_blank">
              <HelpCircle className="mr-2 h-4 w-4" />
              Help & Support
            </Link>
          </DropdownMenuItem>
        </DropdownMenuGroup>
        <DropdownMenuSeparator />
        <DropdownMenuItem onClick={() => setTheme(theme === "dark" ? "light" : "dark")}>
          {theme === "dark" ? <Sun className="mr-2 h-4 w-4" /> : <Moon className="mr-2 h-4 w-4" />}
          {theme === "dark" ? "Light Mode" : "Dark Mode"}
        </DropdownMenuItem>
        <DropdownMenuSeparator />
        <DropdownMenuItem className="text-[var(--ds-red-600)]">
          <LogOut className="mr-2 h-4 w-4" />
          Sign Out
        </DropdownMenuItem>
      </DropdownMenuContent>
    </DropdownMenu>
  );
}


// =============================================================================
// STANDALONE SIDEBAR CLIENT (SELF-CONTAINED FOR R&D)
// =============================================================================

interface StandaloneSidebarProps {
  tenantName: string;
  storeLogo?: string | null;
  pendingOrdersCount: number;
  userEmail: string;
  userAvatarUrl?: string | null;
  userFullName?: string | null;
  userRole?: UserRole;
  planType?: PlanType;
  trialDaysLeft?: number;
  lowStockCount?: number;
  storeSlug?: string;
}

function StandaloneSidebar({
  tenantName,
  storeLogo,
  pendingOrdersCount,
  userEmail,
  userAvatarUrl,
  userFullName,
  userRole = "owner",
  planType = "trial",
  trialDaysLeft = 7,
  lowStockCount = 0,
  storeSlug,
}: StandaloneSidebarProps) {
  const pathname = usePathname();
  const { state } = useSidebar();
  const isCollapsed = state === "collapsed";

  const [openSections, setOpenSections] = useState<string[]>(() => {
    const sections: string[] = [];
    if (pathname.startsWith("/dashboard/orders")) sections.push("orders");
    if (pathname.startsWith("/dashboard/products") || pathname.startsWith("/dashboard/collections") || pathname.startsWith("/dashboard/categories")) sections.push("products");
    if (pathname.startsWith("/dashboard/inventory")) sections.push("inventory");
    if (pathname.startsWith("/dashboard/customers")) sections.push("customers");
    if (pathname.startsWith("/dashboard/marketing")) sections.push("marketing");
    if (pathname.startsWith("/dashboard/settings")) sections.push("settings");
    return sections;
  });

  const navigation = useMemo(
    () => createNavigation({ pendingOrders: pendingOrdersCount, lowStock: lowStockCount }),
    [pendingOrdersCount, lowStockCount]
  );

  const isActive = useCallback(
    (href: string) => {
      if (href === "/dashboard") return pathname === "/dashboard";
      const basePath = href.split("?")[0];
      return pathname === basePath || pathname.startsWith(basePath + "/");
    },
    [pathname]
  );

  const toggleSection = useCallback((id: string) => {
    setOpenSections((prev) =>
      prev.includes(id) ? prev.filter((s) => s !== id) : [...prev, id]
    );
  }, []);

  return (
    <TooltipProvider delayDuration={150}>
      {/* Header - Store Switcher */}
      <SidebarHeader className={cn("p-3", isCollapsed && "p-2")}>
        <StoreSwitcher
          tenantName={tenantName}
          storeLogo={storeLogo}
          planType={planType}
          trialDaysLeft={trialDaysLeft}
          storeSlug={storeSlug}
          isCollapsed={isCollapsed}
        />
      </SidebarHeader>

      {/* Main Navigation */}
      <SidebarContent className={cn("px-3", isCollapsed && "px-0")}>
        {navigation.map((section) => (
          <SidebarGroup key={section.id} className="py-1">
            {section.label && !isCollapsed && (
              <SidebarGroupLabel className="text-xs font-medium text-[var(--ds-gray-600)] uppercase tracking-wider px-2 mb-1">
                {section.label}
              </SidebarGroupLabel>
            )}
            <SidebarGroupContent>
              <SidebarMenu>
                {section.items.map((item) => (
                  <NavItemComponent
                    key={item.id}
                    item={item}
                    isActive={isActive(item.href)}
                    isCollapsed={isCollapsed}
                    isOpen={openSections.includes(item.id)}
                    onToggle={() => toggleSection(item.id)}
                    pathname={pathname}
                  />
                ))}
              </SidebarMenu>
            </SidebarGroupContent>
          </SidebarGroup>
        ))}

        {/* Indigo AI Services Section */}
        <SidebarGroup className="py-2 mt-2 border-t border-[var(--ds-gray-200)]">
          <SidebarGroupContent>
            <IndigoServicesPanel isCollapsed={isCollapsed} />
          </SidebarGroupContent>
        </SidebarGroup>

        {/* Settings Section */}
        <SidebarGroup className="py-1 mt-auto">
          <SidebarGroupContent>
            <SidebarMenu>
              <NavItemComponent
                item={{
                  id: "settings",
                  title: "Settings",
                  href: "/dashboard/settings",
                  icon: Settings,
                  children: [
                    { id: "settings-general", title: "General", href: "/dashboard/settings" },
                    { id: "settings-account", title: "Account", href: "/dashboard/settings/account" },
                    { id: "settings-team", title: "Team", href: "/dashboard/settings/team" },
                    { id: "settings-payments", title: "Payments", href: "/dashboard/settings/payments" },
                    { id: "settings-checkout", title: "Checkout", href: "/dashboard/settings/checkout" },
                    { id: "settings-shipping", title: "Shipping", href: "/dashboard/settings/shipping" },
                    { id: "settings-domains", title: "Domains", href: "/dashboard/settings/domains" },
                    { id: "settings-currency", title: "Currency", href: "/dashboard/settings/currency" },
                    { id: "settings-notifications", title: "Notifications", href: "/dashboard/settings/notifications" },
                  ],
                }}
                isActive={isActive("/dashboard/settings")}
                isCollapsed={isCollapsed}
                isOpen={openSections.includes("settings")}
                onToggle={() => toggleSection("settings")}
                pathname={pathname}
              />
            </SidebarMenu>
          </SidebarGroupContent>
        </SidebarGroup>
      </SidebarContent>

      {/* Footer - Upgrade Banner & User Menu */}
      <SidebarFooter className={cn("p-3", isCollapsed && "p-2 gap-2")}>
        {/* Upgrade Banner */}
        {!isCollapsed && planType !== "pro" && (
          <div className="mb-3 p-3 rounded-lg bg-gradient-to-br from-[var(--ds-blue-100)] to-[var(--ds-purple-100)] border border-[var(--ds-blue-200)]">
            <div className="flex items-center gap-2 mb-2">
              <div className="p-1.5 rounded-md bg-[var(--ds-blue-200)]">
                <Rocket className="h-4 w-4 text-[var(--ds-blue-700)]" />
              </div>
              <div>
                <p className="text-xs font-semibold text-[var(--ds-gray-900)]">
                  {planType === "trial" ? "Pro Trial" : "Free Plan"}
                </p>
                {planType === "trial" && (
                  <p className="text-[10px] text-[var(--ds-blue-700)] font-medium">
                    {trialDaysLeft} days remaining
                  </p>
                )}
              </div>
            </div>
            <Button size="sm" className="w-full text-xs h-8">
              <Rocket className="h-3.5 w-3.5 mr-1.5" />
              Upgrade to Pro
            </Button>
          </div>
        )}

        {/* Pro Badge */}
        {!isCollapsed && planType === "pro" && (
          <div className="mb-3 p-3 rounded-lg bg-[var(--ds-green-100)] border border-[var(--ds-green-200)]">
            <div className="flex items-center gap-2">
              <div className="p-1.5 rounded-md bg-[var(--ds-green-200)]">
                <CheckCircle className="h-4 w-4 text-[var(--ds-green-700)]" />
              </div>
              <div>
                <p className="text-xs font-semibold text-[var(--ds-gray-900)]">Pro Plan</p>
                <p className="text-[10px] text-[var(--ds-green-700)]">All features unlocked</p>
              </div>
            </div>
          </div>
        )}

        {/* User Menu */}
        <UserMenuComponent
          userEmail={userEmail}
          userAvatarUrl={userAvatarUrl}
          userFullName={userFullName}
          userRole={userRole}
          isCollapsed={isCollapsed}
        />
      </SidebarFooter>
    </TooltipProvider>
  );
}


// =============================================================================
// DEMO CONTENT COMPONENT (Animated Icons Showcase - Kept Intact)
// =============================================================================

function DemoContent() {
  const { state, toggleSidebar } = useSidebar();
  
  // Animation demo states
  const [checkAnimate, setCheckAnimate] = useState(true);
  const [arrowDirection, setArrowDirection] = useState<"up" | "down" | "left" | "right">("right");
  const [isPlus, setIsPlus] = useState(true);
  const [hamburgerOpen, setHamburgerOpen] = useState(false);
  const [chevronOpen, setChevronOpen] = useState(false);
  const [heartFilled, setHeartFilled] = useState(false);
  const [starFilled, setStarFilled] = useState(false);
  const [bellNotification, setBellNotification] = useState(false);
  const [bellRing, setBellRing] = useState(false);
  const [copied, setCopied] = useState(false);
  const [bookmarkFilled, setBookmarkFilled] = useState(false);
  const [trashShake, setTrashShake] = useState(false);
  const [notificationCount, setNotificationCount] = useState(5);
  const [checkbox1, setCheckbox1] = useState(false);
  const [checkbox2, setCheckbox2] = useState(true);
  const [toggle1, setToggle1] = useState(false);
  const [toggle2, setToggle2] = useState(true);
  const [inputValue, setInputValue] = useState("");
  const [inputError, setInputError] = useState("");
  const [inputSuccess, setInputSuccess] = useState(false);
  const [staggerKey, setStaggerKey] = useState(0);

  const validateInput = (value: string) => {
    setInputValue(value);
    if (value.length === 0) {
      setInputError("");
      setInputSuccess(false);
    } else if (value.length < 3) {
      setInputError("Must be at least 3 characters");
      setInputSuccess(false);
    } else {
      setInputError("");
      setInputSuccess(true);
    }
  };

  return (
    <div className="p-6 space-y-8">
      {/* Sidebar Controls */}
      <div className="flex items-center gap-4">
        <Button variant="outline" size="sm" onClick={toggleSidebar} className="gap-2">
          <PanelLeft className="h-4 w-4" />
          {state === "expanded" ? "Collapse" : "Expand"}
        </Button>
        <div className="flex items-center gap-2">
          <span className="text-sm text-[var(--ds-gray-600)]">State:</span>
          <code className="rounded bg-[var(--ds-gray-200)] px-2 py-1 text-xs font-mono">
            {state}
          </code>
        </div>
        <div className="flex items-center gap-2">
          <span className="text-sm text-[var(--ds-gray-600)]">Width:</span>
          <code className="rounded bg-[var(--ds-gray-200)] px-2 py-1 text-xs font-mono">
            {state === "expanded" ? "256px (16rem)" : "48px (3rem)"}
          </code>
        </div>
      </div>

      {/* Sidebar Animation Info - Updated for Professional Mode */}
      <section className="space-y-4">
        <div>
          <h2 className="text-lg font-semibold text-[var(--ds-gray-900)]">Sidebar Animations (Professional CSS)</h2>
          <p className="text-sm text-[var(--ds-gray-600)]">
            Simple, professional CSS transitions following Vercel/Geist design patterns. No bouncing, no magnetic effects, no 3D tilts.
          </p>
        </div>
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-4">
          <div className="grid gap-4 md:grid-cols-2 lg:grid-cols-4">
            <div className="space-y-1">
              <h4 className="text-xs font-medium text-[var(--ds-gray-600)] uppercase tracking-wider">Hover States</h4>
              <p className="text-sm text-[var(--ds-gray-800)]">transition-colors duration-150</p>
              <p className="text-xs text-[var(--ds-gray-500)]">Background color change</p>
            </div>
            <div className="space-y-1">
              <h4 className="text-xs font-medium text-[var(--ds-gray-600)] uppercase tracking-wider">Tap Feedback</h4>
              <p className="text-sm text-[var(--ds-gray-800)]">active:scale-[0.98]</p>
              <p className="text-xs text-[var(--ds-gray-500)]">Subtle press effect</p>
            </div>
            <div className="space-y-1">
              <h4 className="text-xs font-medium text-[var(--ds-gray-600)] uppercase tracking-wider">Chevron Rotation</h4>
              <p className="text-sm text-[var(--ds-gray-800)]">transition-transform duration-200</p>
              <p className="text-xs text-[var(--ds-gray-500)]">CSS rotate-90</p>
            </div>
            <div className="space-y-1">
              <h4 className="text-xs font-medium text-[var(--ds-gray-600)] uppercase tracking-wider">Focus States</h4>
              <p className="text-sm text-[var(--ds-gray-800)]">focus-visible:ring-2</p>
              <p className="text-xs text-[var(--ds-gray-500)]">Keyboard accessibility</p>
            </div>
          </div>
          <div className="mt-4 pt-4 border-t border-[var(--ds-gray-200)]">
            <p className="text-xs text-[var(--ds-gray-500)]">
              <strong>Pattern:</strong> Simple CSS transitions (150ms) for color changes, subtle scale on active state. 
              <strong className="ml-2">No:</strong> Spring physics, magnetic effects, 3D tilts, bouncing icons, pulsing badges.
            </p>
          </div>
        </div>
      </section>

      {/* Animated Icons Section */}
      <section className="space-y-4">
        <div>
          <h2 className="text-lg font-semibold text-[var(--ds-gray-900)]">Animated Icons</h2>
          <p className="text-sm text-[var(--ds-gray-600)]">Interactive icons with smooth state transitions. Click to toggle.</p>
        </div>
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-6">
          <div className="grid grid-cols-3 gap-4 sm:grid-cols-5 lg:grid-cols-8">
            <DemoCard label="Check">
              <button onClick={() => setCheckAnimate(!checkAnimate)} className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedCheck key={String(checkAnimate)} size={24} animate={checkAnimate} />
              </button>
            </DemoCard>
            <DemoCard label="X">
              <button className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedX size={24} />
              </button>
            </DemoCard>
            <DemoCard label="Arrow">
              <button onClick={() => {
                const directions: ("up" | "down" | "left" | "right")[] = ["right", "down", "left", "up"];
                const currentIndex = directions.indexOf(arrowDirection);
                setArrowDirection(directions[(currentIndex + 1) % 4]);
              }} className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedArrow size={24} direction={arrowDirection} />
              </button>
            </DemoCard>
            <DemoCard label="Plus/Minus">
              <button onClick={() => setIsPlus(!isPlus)} className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedPlusMinus size={24} isPlus={isPlus} />
              </button>
            </DemoCard>
            <DemoCard label="Hamburger">
              <button onClick={() => setHamburgerOpen(!hamburgerOpen)} className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedHamburger size={24} isOpen={hamburgerOpen} />
              </button>
            </DemoCard>
            <DemoCard label="Chevron">
              <button onClick={() => setChevronOpen(!chevronOpen)} className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedChevron size={24} isOpen={chevronOpen} />
              </button>
            </DemoCard>
            <DemoCard label="Heart">
              <button onClick={() => setHeartFilled(!heartFilled)} className="rounded-md p-2 text-[var(--ds-red-500)] hover:bg-[var(--ds-gray-100)]">
                <AnimatedHeart size={24} filled={heartFilled} />
              </button>
            </DemoCard>
            <DemoCard label="Star">
              <button onClick={() => setStarFilled(!starFilled)} className="rounded-md p-2 text-[var(--ds-amber-500)] hover:bg-[var(--ds-gray-100)]">
                <AnimatedStar size={24} filled={starFilled} />
              </button>
            </DemoCard>
            <DemoCard label="Bell">
              <button onClick={() => {
                setBellNotification(!bellNotification);
                setBellRing(true);
                setTimeout(() => setBellRing(false), 500);
              }} className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedBell size={24} hasNotification={bellNotification} ring={bellRing} />
              </button>
            </DemoCard>
            <DemoCard label="Copy">
              <button onClick={() => {
                setCopied(true);
                setTimeout(() => setCopied(false), 2000);
              }} className="rounded-md p-2 hover:bg-[var(--ds-gray-100)]">
                <AnimatedCopy size={24} copied={copied} />
              </button>
            </DemoCard>
            <DemoCard label="Spinner">
              <div className="rounded-md p-2">
                <AnimatedSpinner size={24} />
              </div>
            </DemoCard>
            <DemoCard label="Success">
              <AnimatedSuccess size={32} />
            </DemoCard>
            <DemoCard label="Error">
              <AnimatedError size={32} />
            </DemoCard>
            <DemoCard label="Bookmark">
              <button onClick={() => setBookmarkFilled(!bookmarkFilled)} className="rounded-md p-2 text-[var(--ds-blue-500)] hover:bg-[var(--ds-gray-100)]">
                <AnimatedBookmark size={24} filled={bookmarkFilled} />
              </button>
            </DemoCard>
            <DemoCard label="Trash">
              <button onClick={() => {
                setTrashShake(true);
                setTimeout(() => setTrashShake(false), 500);
              }} className="rounded-md p-2 text-[var(--ds-red-500)] hover:bg-[var(--ds-gray-100)]">
                <AnimatedTrash size={24} shake={trashShake} />
              </button>
            </DemoCard>
          </div>
        </div>
      </section>

      {/* Animated Buttons Section */}
      <section className="space-y-4">
        <div>
          <h2 className="text-lg font-semibold text-[var(--ds-gray-900)]">Animated Buttons</h2>
          <p className="text-sm text-[var(--ds-gray-600)]">Button components with various hover and tap animations.</p>
        </div>
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-6 space-y-6">
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">Button Variants</h3>
            <div className="flex flex-wrap gap-3">
              <AnimatedButton variant="default">Default</AnimatedButton>
              <AnimatedButton variant="bounce">Bounce</AnimatedButton>
              <AnimatedButton variant="pulse">Pulse</AnimatedButton>
              <AnimatedButton variant="glow">Glow</AnimatedButton>
              <AnimatedButton variant="shake">Shake</AnimatedButton>
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">Icon Button Variants</h3>
            <div className="flex flex-wrap gap-3">
              <AnimatedIconButton variant="default"><Settings className="h-4 w-4" /></AnimatedIconButton>
              <AnimatedIconButton variant="spin"><RefreshCw className="h-4 w-4" /></AnimatedIconButton>
              <AnimatedIconButton variant="bounce"><Star className="h-4 w-4" /></AnimatedIconButton>
              <AnimatedIconButton variant="wiggle"><Bell className="h-4 w-4" /></AnimatedIconButton>
            </div>
          </div>
        </div>
      </section>

      {/* Animated Cards Section */}
      <section className="space-y-4">
        <div>
          <h2 className="text-lg font-semibold text-[var(--ds-gray-900)]">Animated Cards</h2>
          <p className="text-sm text-[var(--ds-gray-600)]">Card components with different hover effects.</p>
        </div>
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-6">
          <div className="grid gap-4 sm:grid-cols-2 lg:grid-cols-5">
            <AnimatedCard variant="lift">
              <h4 className="text-sm font-medium text-[var(--ds-gray-900)]">Lift</h4>
              <p className="text-xs text-[var(--ds-gray-600)]">Hover to lift up</p>
            </AnimatedCard>
            <AnimatedCard variant="scale">
              <h4 className="text-sm font-medium text-[var(--ds-gray-900)]">Scale</h4>
              <p className="text-xs text-[var(--ds-gray-600)]">Hover to scale</p>
            </AnimatedCard>
            <AnimatedCard variant="glow">
              <h4 className="text-sm font-medium text-[var(--ds-gray-900)]">Glow</h4>
              <p className="text-xs text-[var(--ds-gray-600)]">Hover for glow</p>
            </AnimatedCard>
            <AnimatedCard variant="border">
              <h4 className="text-sm font-medium text-[var(--ds-gray-900)]">Border</h4>
              <p className="text-xs text-[var(--ds-gray-600)]">Hover for border</p>
            </AnimatedCard>
            <AnimatedCard variant="tilt">
              <h4 className="text-sm font-medium text-[var(--ds-gray-900)]">Tilt</h4>
              <p className="text-xs text-[var(--ds-gray-600)]">Hover to tilt</p>
            </AnimatedCard>
          </div>
        </div>
      </section>

      {/* Animated Badges Section */}
      <section className="space-y-4">
        <div>
          <h2 className="text-lg font-semibold text-[var(--ds-gray-900)]">Animated Badges</h2>
          <p className="text-sm text-[var(--ds-gray-600)]">Status badges with entrance animations and pulse effects.</p>
        </div>
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-6 space-y-6">
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">Badge Variants</h3>
            <div className="flex flex-wrap gap-3">
              <AnimatedBadge variant="default">Default</AnimatedBadge>
              <AnimatedBadge variant="success">Success</AnimatedBadge>
              <AnimatedBadge variant="warning">Warning</AnimatedBadge>
              <AnimatedBadge variant="error">Error</AnimatedBadge>
              <AnimatedBadge variant="info">Info</AnimatedBadge>
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">With Pulse Animation</h3>
            <div className="flex flex-wrap gap-3">
              <AnimatedBadge variant="success" pulse>Live</AnimatedBadge>
              <AnimatedBadge variant="error" pulse>Recording</AnimatedBadge>
              <AnimatedBadge variant="info" pulse>Syncing</AnimatedBadge>
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">NotificationDot</h3>
            <div className="flex items-center gap-6">
              <div className="relative">
                <button className="h-10 w-10 rounded-md bg-[var(--ds-gray-100)] flex items-center justify-center">
                  <Bell className="h-5 w-5 text-[var(--ds-gray-600)]" />
                </button>
                <NotificationDot count={notificationCount} />
              </div>
              <div className="flex gap-2">
                <button onClick={() => setNotificationCount(Math.max(0, notificationCount - 1))} className="h-8 px-3 rounded-md border border-[var(--ds-gray-300)] text-sm">âˆ’</button>
                <button onClick={() => setNotificationCount(notificationCount + 1)} className="h-8 px-3 rounded-md border border-[var(--ds-gray-300)] text-sm">+</button>
              </div>
              <span className="text-sm text-[var(--ds-gray-600)]">Count: {notificationCount}</span>
            </div>
          </div>
        </div>
      </section>

      {/* Form Components Section */}
      <section className="space-y-4">
        <div>
          <h2 className="text-lg font-semibold text-[var(--ds-gray-900)]">Form Components</h2>
          <p className="text-sm text-[var(--ds-gray-600)]">Animated form controls with validation states.</p>
        </div>
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-6 space-y-6">
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">AnimatedCheckbox</h3>
            <div className="flex gap-6">
              <AnimatedCheckbox checked={checkbox1} onChange={setCheckbox1} label="Unchecked by default" />
              <AnimatedCheckbox checked={checkbox2} onChange={setCheckbox2} label="Checked by default" />
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">AnimatedToggle</h3>
            <div className="flex items-center gap-6">
              <div className="flex items-center gap-2">
                <AnimatedToggle size="sm" checked={toggle1} onChange={setToggle1} />
                <span className="text-sm text-[var(--ds-gray-600)]">Small</span>
              </div>
              <div className="flex items-center gap-2">
                <AnimatedToggle size="md" checked={toggle2} onChange={setToggle2} />
                <span className="text-sm text-[var(--ds-gray-600)]">Medium</span>
              </div>
              <div className="flex items-center gap-2">
                <AnimatedToggle size="lg" checked={toggle1} onChange={setToggle1} />
                <span className="text-sm text-[var(--ds-gray-600)]">Large</span>
              </div>
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">AnimatedInput</h3>
            <div className="max-w-sm">
              <AnimatedInput
                label="Username"
                placeholder="Enter at least 3 charactersâ€¦"
                value={inputValue}
                onChange={(e) => validateInput(e.target.value)}
                error={inputError}
                success={inputSuccess}
              />
            </div>
          </div>
        </div>
      </section>

      {/* Animation Wrappers Section */}
      <section className="space-y-4">
        <div>
          <h2 className="text-lg font-semibold text-[var(--ds-gray-900)]">Animation Wrappers</h2>
          <p className="text-sm text-[var(--ds-gray-600)]">Reusable wrapper components that add animations to any child element.</p>
        </div>
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-6 space-y-6">
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">HoverScale</h3>
            <div className="flex gap-4">
              <HoverScale scale={1.05}>
                <div className="h-20 w-20 rounded-lg bg-[var(--ds-gray-100)] flex items-center justify-center">
                  <span className="text-xs text-[var(--ds-gray-600)]">1.05x</span>
                </div>
              </HoverScale>
              <HoverScale scale={1.1}>
                <div className="h-20 w-20 rounded-lg bg-[var(--ds-gray-100)] flex items-center justify-center">
                  <span className="text-xs text-[var(--ds-gray-600)]">1.1x</span>
                </div>
              </HoverScale>
              <HoverScale scale={1.15}>
                <div className="h-20 w-20 rounded-lg bg-[var(--ds-gray-100)] flex items-center justify-center">
                  <span className="text-xs text-[var(--ds-gray-600)]">1.15x</span>
                </div>
              </HoverScale>
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">TapBounce</h3>
            <div className="flex gap-4">
              <TapBounce bounceScale={0.9}>
                <div className="h-20 w-20 rounded-lg bg-[var(--ds-blue-100)] flex items-center justify-center cursor-pointer">
                  <span className="text-xs text-[var(--ds-blue-700)]">0.9x</span>
                </div>
              </TapBounce>
              <TapBounce bounceScale={0.95}>
                <div className="h-20 w-20 rounded-lg bg-[var(--ds-blue-100)] flex items-center justify-center cursor-pointer">
                  <span className="text-xs text-[var(--ds-blue-700)]">0.95x</span>
                </div>
              </TapBounce>
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">StaggerList</h3>
            <div className="flex items-start gap-4">
              <StaggerList key={staggerKey} className="w-48">
                {["Item 1", "Item 2", "Item 3", "Item 4"].map((item) => (
                  <StaggerItem key={item}>
                    <div className="rounded-md bg-[var(--ds-gray-100)] px-3 py-2 text-sm">{item}</div>
                  </StaggerItem>
                ))}
              </StaggerList>
              <button onClick={() => setStaggerKey((k) => k + 1)} className="h-8 px-3 rounded-md border border-[var(--ds-gray-300)] text-sm">Replay</button>
            </div>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">Magnetic</h3>
            <div className="flex gap-6">
              <Magnetic strength={0.3}>
                <div className="h-16 w-16 rounded-full bg-[var(--ds-gray-900)] flex items-center justify-center cursor-pointer">
                  <Heart className="h-6 w-6 text-white" />
                </div>
              </Magnetic>
              <Magnetic strength={0.5}>
                <div className="h-16 w-16 rounded-full bg-[var(--ds-blue-600)] flex items-center justify-center cursor-pointer">
                  <Star className="h-6 w-6 text-white" />
                </div>
              </Magnetic>
            </div>
            <p className="mt-2 text-xs text-[var(--ds-gray-500)]">Move your cursor near the elements</p>
          </div>
          <div>
            <h3 className="mb-3 text-sm font-medium text-[var(--ds-gray-900)]">TiltCard</h3>
            <div className="flex gap-4">
              <TiltCard maxTilt={10} className="w-40">
                <h4 className="text-sm font-medium text-[var(--ds-gray-900)]">10Â° Tilt</h4>
                <p className="text-xs text-[var(--ds-gray-600)]">Move cursor over card</p>
              </TiltCard>
              <TiltCard maxTilt={20} className="w-40">
                <h4 className="text-sm font-medium text-[var(--ds-gray-900)]">20Â° Tilt</h4>
                <p className="text-xs text-[var(--ds-gray-600)]">More dramatic effect</p>
              </TiltCard>
            </div>
          </div>
        </div>
      </section>

      {/* Sidebar Features & Technical Details */}
      <div className="grid gap-6 md:grid-cols-2">
        {/* Features Card */}
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-4">
          <h3 className="text-sm font-semibold text-[var(--ds-gray-900)] mb-3">Sidebar Features</h3>
          <ul className="space-y-2 text-sm text-[var(--ds-gray-600)]">
            <li className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-[var(--ds-green-600)] mt-0.5 shrink-0" />
              <span>Icons centered in 48px rail when collapsed</span>
            </li>
            <li className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-[var(--ds-green-600)] mt-0.5 shrink-0" />
              <span>40px hit targets for accessibility (WCAG compliant)</span>
            </li>
            <li className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-[var(--ds-green-600)] mt-0.5 shrink-0" />
              <span>Dropdown menus for nav items with children</span>
            </li>
            <li className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-[var(--ds-green-600)] mt-0.5 shrink-0" />
              <span>Store switcher accessible in both states</span>
            </li>
            <li className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-[var(--ds-green-600)] mt-0.5 shrink-0" />
              <span>User menu with account options</span>
            </li>
            <li className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-[var(--ds-green-600)] mt-0.5 shrink-0" />
              <span>Indigo AI services panel</span>
            </li>
            <li className="flex items-start gap-2">
              <CheckCircle className="h-4 w-4 text-[var(--ds-green-600)] mt-0.5 shrink-0" />
              <span>Keyboard shortcut: âŒ˜B to toggle</span>
            </li>
          </ul>
        </div>

        {/* Technical Details Card */}
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-4">
          <h3 className="text-sm font-semibold text-[var(--ds-gray-900)] mb-3">Technical Details</h3>
          <dl className="space-y-3 text-sm">
            <div>
              <dt className="text-[var(--ds-gray-600)]">Expanded Width</dt>
              <dd className="font-mono text-[var(--ds-gray-900)]">--sidebar-width: 16rem (256px)</dd>
            </div>
            <div>
              <dt className="text-[var(--ds-gray-600)]">Collapsed Width</dt>
              <dd className="font-mono text-[var(--ds-gray-900)]">--sidebar-width-icon: 3rem (48px)</dd>
            </div>
            <div>
              <dt className="text-[var(--ds-gray-600)]">Icon Button Size</dt>
              <dd className="font-mono text-[var(--ds-gray-900)]">h-10 w-10 (40px Ã— 40px)</dd>
            </div>
            <div>
              <dt className="text-[var(--ds-gray-600)]">Animation Style</dt>
              <dd className="font-mono text-[var(--ds-gray-900)]">CSS Transitions (Professional)</dd>
            </div>
            <div>
              <dt className="text-[var(--ds-gray-600)]">Transition Duration</dt>
              <dd className="font-mono text-[var(--ds-gray-900)]">150ms (colors), 200ms (transform)</dd>
            </div>
            <div>
              <dt className="text-[var(--ds-gray-600)]">State Attribute</dt>
              <dd className="font-mono text-[var(--ds-gray-900)]">data-collapsible="icon"</dd>
            </div>
          </dl>
        </div>

        {/* CSS Patterns Card */}
        <div className="rounded-lg border border-[var(--ds-gray-200)] bg-white p-4 md:col-span-2">
          <h3 className="text-sm font-semibold text-[var(--ds-gray-900)] mb-3">Professional Animation Patterns</h3>
          <div className="grid gap-4 md:grid-cols-2">
            <div>
              <h4 className="text-xs font-medium text-[var(--ds-gray-600)] mb-2">CSS Transition Classes</h4>
              <pre className="text-xs bg-[var(--ds-gray-100)] p-3 rounded-md overflow-x-auto">
{`// Hover background color
className="transition-colors duration-150 
  hover:bg-[var(--ds-gray-100)]"

// Tap feedback
className="active:scale-[0.98]"

// Chevron rotation
className="transition-transform duration-200"
// + conditional: isOpen && "rotate-90"

// Focus states
className="focus-visible:outline-none 
  focus-visible:ring-2 
  focus-visible:ring-[var(--ds-blue-600)]"`}
              </pre>
            </div>
            <div>
              <h4 className="text-xs font-medium text-[var(--ds-gray-600)] mb-2">Vercel/Geist Principles</h4>
              <pre className="text-xs bg-[var(--ds-gray-100)] p-3 rounded-md overflow-x-auto">
{`// âœ… Professional patterns
- transition-colors duration-150
- hover:bg-[var(--ds-gray-100)]
- active:scale-[0.98] (subtle)
- CSS rotate for chevrons

// âŒ Removed playful patterns
- No spring physics
- No magnetic cursor effects
- No 3D tilt transforms
- No bouncing icons
- No pulsing badges
- No stagger animations`}
              </pre>
            </div>
          </div>
        </div>
      </div>
    </div>
  );
}


// =============================================================================
// MAIN PAGE COMPONENT
// =============================================================================

export default function SidebarDemoPage() {
  return (
    <div className="min-h-screen bg-[var(--ds-gray-100)]">
      {/* Header */}
      <header className="border-b border-[var(--ds-gray-200)] bg-white px-6 py-4">
        <div className="flex items-center justify-between">
          <div>
            <h1 className="text-xl font-semibold text-[var(--ds-gray-1000)]">
              Sidebar R&D Demo (Professional Mode)
            </h1>
            <p className="text-sm text-[var(--ds-gray-600)]">
              Simple CSS transitions following Vercel/Geist design patterns
            </p>
          </div>
          <Link
            href="/demo/animations"
            className="text-sm text-[var(--ds-blue-600)] hover:text-[var(--ds-blue-700)] hover:underline"
          >
            â† Back to Animations
          </Link>
        </div>
      </header>

      {/* Main Demo Area */}
      <div className="h-[calc(100vh-73px)]">
        <SidebarProvider defaultOpen={true}>
          <div className="flex h-full w-full">
            <Sidebar collapsible="icon" className="border-r border-[var(--ds-gray-200)]">
              <StandaloneSidebar
                tenantName="Demo Store"
                storeLogo={null}
                pendingOrdersCount={3}
                userEmail="demo@indigo.store"
                userAvatarUrl={null}
                userFullName="Demo User"
                userRole="owner"
                planType="trial"
                trialDaysLeft={14}
                lowStockCount={5}
                storeSlug="demo"
              />
            </Sidebar>
            <SidebarInset className="flex-1 bg-[var(--ds-gray-50)] overflow-auto">
              <DemoContent />
            </SidebarInset>
          </div>
        </SidebarProvider>
      </div>
    </div>
  );
}